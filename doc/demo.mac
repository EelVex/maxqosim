/*** 
* Quantum Harmonic Oscillator with dissipation
* */

load("maxqosim.mac")$

n: 2$
ğ“¢: [n, 2]$ /* Hilbert space n âŠ— 2 */
hbar: 1$

/* Hamiltonian for Quantum Oscillator */
/* Î± is by default an annihilation operator but we can declare it such:
boperator(Î±, 1);
for an operator belonging to space with index 1.
*/
H0: hbar * Ï‰['c] * (Î±â€ .Î±);
H1: hbar * Ï‰['a] * Ïƒ['z]/2;
Hint: hbar*Î©(t)/2*((Î± âŠ— Ïƒ['plus]) + (Î±â€  âŠ— Ïƒ['minus]));

H: H0 + H1 + Hint;

/* Define the Lindblad operators and parameters */
ğ“•[1]: ğ•³(Î±, ğ“¢, [1]); 	Î³[1]: g/2*(n + 1);
ğ“•[2]: ğ•³(Î±â€ , ğ“¢, [1]);	Î³[2]: g/2*n;

/* Perform calculations, simplifications, approximation, etc */
/* ... as needed */

/* Convert to matrix form */
Hm: ğ•³(H0, ğ“¢, [1]) + ğ•³(H1, ğ“¢, [2]) + ğ•³(Hint, ğ“¢, [1,2]);

/* Store parameters */
save_parameter([Ï‰['c], 0.25, "Hz"], [Ï‰['a], 0.25, "Hz"], [Î©[0], 1, "meV"]);
save_parameter(['t[0], 0], ['t['fin], 1], ['t['p], 0.5]);
save_parameter([g, 0.1]);

/* Store functions */
save_function(["Î©(t)", Î©[0]*exp(t-'t['p])]);

/* Return list of system of equations */
eq: ğ“›(Ï, Hm, ğ“•, Î³)$
eq[1];

/* Solve the lindblad master equation using maxima methods */
[times, rhos]: lindblad_solve(Hm, ğ“•, Î³, rho_init(1, apply("*",ğ“¢)), 't[0], 't['fin], 1e-4)$
time(%);
plot_rho(times, rhos, [1,1], [3,3]);

/* Export and solve the lindblad master equation using a Fortran template */
lindblad_fortran(Hm, ğ“•, Î³, rho_init(1, apply("*",ğ“¢)), 't[0], 't['fin], 1e-5, 100, "results.dat");
time(%);
[times, rhos]: read_results("f90_template/results.dat")$
plot_rho(times, rhos, [1,1], [3,3]);

/* Export definitions for use in latex */
load("totex.mac")$
tex_export("doc/definitions.tex", "Hamiltonian", H, "hint", Hint, "eqs", eq[1]);
tex_export_params("doc/parameters.tex");
